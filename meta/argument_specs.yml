---
argument_specs:
  main:
    short_description: Main entry point for the Kibana role
    options:
      kibana:
        type: "dict"
        required: true
        options:
          use_dehydrated:
            type: "bool"
            default: true
            description:
              - Whether to configure an SSL certificate and a reverse proxy for Kibana.
              - If set to `true`, will use ansible-proserver-nginx and ansible-proserver-dehydrated
                to set up an Nginx-based reverse proxy with a valid SSL certificate that listens on
                0.0.0.0:443.
              - In order for this to work, `kibana.domain` has to be set to a valid, DNS-resolvable
                FQDN.
              - Please consult the documentation of
                [ansible-proserver-dehydrated](https://github.com/punktDe/ansible-proserver-dehydrated)
                for available challenges.
          domain:
            type: "str"
            description:
              - Domain used for the Kibana reverse proxy (server_name and SSL certificate).
              - Required when `kibana.use_dehydrated` is true.
          version:
            type: "int"
            default: 8
            description:
              - The major version of Kibana to be configured/installed.
              - When set to >= 8, the role applies systemd service overrides for the Kibana process.
          prefix:
            type: "dict"
            description:
              - Sets folders/prefixes for Kibana directories.
            options:
              config:
                type: "str"
                description:
                  - Path for configuration files (e.g. kibana.yml).
                  - Defaults to /etc/kibana on Linux and /usr/local/etc/kibana on FreeBSD Proserver.
          repository:
            type: "dict"
            description:
              - Configuration options for the package repository used to install Kibana.
            options:
              apt:
                type: "dict"
                description:
                  - Configuration options for APT repository (only applies for Debian-based systems).
                options:
                  key_url:
                    type: "str"
                    default: https://artifacts.elastic.co/GPG-KEY-elasticsearch
                  repository:
                    type: "str"
                    default: "https://artifacts.elastic.co/packages/{{ kibana.version }}.x/apt"
          oauth2_proxy:
            type: "str"
            required: false
            description:
              - Key of `oauth2_proxy.config` to enable Identity-Aware Proxy (IAP) authentication
                for Kibana behind the reverse proxy.
              - When set, the Nginx configuration will use auth_request to the corresponding
                oauth2_proxy instance (e.g. /proserver/iap).
          kibana.yml:
            type: "dict"
            required: true
            description:
              - Allows to define options included in the kibana.yml file.
              - Consult defaults/main.yaml for options set by default (path.data, xpack settings),
                and https://www.elastic.co/guide/en/kibana/current/settings.html
                for Kibana configuration reference.
              - When Kibana version is >= 8, the keys apm, graph, ml, and reporting are removed
                from the rendered config as they are no longer supported.
